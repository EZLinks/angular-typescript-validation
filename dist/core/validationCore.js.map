{"version":3,"sources":["core/validationCore.ts"],"names":[],"mappings":";;AAAA,mBAAiB;AAKjB;;GAEG;AACH;IAAA;IAuEA,CAAC;IArEG;;;;;;OAMG;IACW,6BAAc,GAA5B,UACI,MAAc,EACd,UAA4B,EAC5B,gBAAkE;QAClE,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,UAAU,CAAC,KAAK,EAAE,CAAC,EAAE,gBAAgB,CAAC,CAAC;IAC7E,CAAC;IAED;;;;;;;OAOG;IACW,4BAAa,GAA3B,UACI,MAAc,EACd,QAAuC,EACvC,QAAgB,EAChB,gBAAkE;QAJtE,iBA8CC;QAvCG,IAAM,QAAQ,GAAuB,EAAE,CAAC;QACxC,IAAI,QAAQ,GAAY,IAAI,CAAC;QAC7B,IAAI,KAAK,GAAsB,QAAQ,CAAC,QAAQ,CAAC,CAAC;gCAEzC,CAAC;YAEN,IAAI,IAAI,GAAoB,KAAK,CAAC,CAAC,CAAC,CAAC;YACrC,IAAI,CAAC,IAAI,EAAE;;aAEV;YAED,IAAI,KAAK,GAAQ,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAE3C,IAAI,OAAO,GAAqB,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC;iBACvD,IAAI,CAAC,UAAA,MAAM;gBAER,gBAAgB,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAE/B,IAAI,CAAC,MAAM,EAAE;oBACT,QAAQ,GAAG,KAAK,CAAC;iBACpB;gBAED,OAAO,MAAM,CAAC;YAClB,CAAC,CAAC,CAAC;YAEP,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC3B,CAAC;QAtBD,KAAK,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE;oBAApC,CAAC;SAsBT;QAED,OAAO,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC;aACvB,IAAI,CAAC;YAEF,QAAQ,EAAE,CAAC;YAEX,IAAI,QAAQ,IAAI,QAAQ,GAAG,QAAQ,CAAC,MAAM,EAAE;gBACxC,OAAO,KAAI,CAAC,aAAa,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,gBAAgB,CAAC,CAAC;aAC3E;YAED,OAAO,QAAQ,CAAC;QACpB,CAAC,CAAC,CAAC;IACX,CAAC;IACL,qBAAC;AAAD,CAvEA,AAuEC,IAAA;AAvEY,wCAAc","file":"validationCore.js","sourcesContent":["import 'angular';\r\n\r\nimport { IValidationRule } from '../interfaces/validationRule';\r\nimport { IRulesCustomizer } from '../interfaces/rulesCustomizer';\r\n\r\n/**\r\n * base methods for validation purposes.\r\n */\r\nexport class ValidationCore {\r\n\r\n    /**\r\n     * makes entity validation - client side and real time server side.\r\n     *\r\n     * @param entity\r\n     * @param customizer\r\n     * @param handleRuleResult\r\n     */\r\n    public static validateEntity(\r\n        entity: Object,\r\n        customizer: IRulesCustomizer,\r\n        handleRuleResult: (rule: IValidationRule, result: boolean) => void): Promise<boolean> {\r\n        return this.validateRules(entity, customizer.rules, 0, handleRuleResult);\r\n    }\r\n\r\n    /**\r\n     * recursively validates rules.\r\n     *\r\n     * @param entity\r\n     * @param seqRules\r\n     * @param sequence\r\n     * @param handleRuleResult\r\n     */\r\n    public static validateRules(\r\n        entity: Object,\r\n        seqRules: Array<Array<IValidationRule>>,\r\n        sequence: number,\r\n        handleRuleResult: (rule: IValidationRule, result: boolean) => void\r\n    ): Promise<boolean> {\r\n\r\n        const promises: Promise<boolean>[] = [];\r\n        let allValid: boolean = true;\r\n        let rules: IValidationRule[] = seqRules[sequence];\r\n\r\n        for (let i: number = 0; i < rules.length; i++) {\r\n\r\n            let rule: IValidationRule = rules[i];\r\n            if (!rule) {\r\n                continue;\r\n            }\r\n\r\n            let value: any = entity[rule.propertyName];\r\n\r\n            let promise: Promise<boolean> = rule.validate(entity, value)\r\n                .then(result => {\r\n\r\n                    handleRuleResult(rule, result);\r\n\r\n                    if (!result) {\r\n                        allValid = false;\r\n                    }\r\n\r\n                    return result;\r\n                });\r\n\r\n            promises.push(promise);\r\n        }\r\n\r\n        return Promise.all(promises)\r\n            .then(() => {\r\n\r\n                sequence++;\r\n\r\n                if (allValid && sequence < seqRules.length) {\r\n                    return this.validateRules(entity, seqRules, sequence, handleRuleResult);\r\n                }\r\n\r\n                return allValid;\r\n            });\r\n    }\r\n}\r\n"]}