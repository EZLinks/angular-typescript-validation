{"version":3,"sources":["controllers/validatableController.ts"],"names":[],"mappings":";AAAA,mBAAiB;AAGjB,0DAAyD;AAGzD,yDAAwD;AAExD;;GAEG;AACH;IAEI;;;;;;OAMG;IACH,+BAAsB,KAAgB,EAAS,eAAiC;QAAhF,iBACC;QADqB,UAAK,GAAL,KAAK,CAAW;QAAS,oBAAe,GAAf,eAAe,CAAkB;QAsBhF;;WAEG;QACO,mBAAc,GAAG,UAAC,SAAiB,EAAE,WAAmB;YAE9D,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC;gBACd,+BAAc,CAAC,mBAAmB,CAAC,SAAS,EAAE,WAAW,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;YAC1E,CAAC,CAAC,CAAC;QACP,CAAC,CAAA;IA7BD,CAAC;IAED;;OAEG;IACO,wCAAQ,GAAlB,UAAmB,MAAc;QAAjC,iBAcC;QAZG,+BAAc,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE7C,MAAM,CAAC,+BAAc,CAAC,cAAc,CAAC,MAAM,EACvC,IAAI,CAAC,eAAe,EACpB,UAAC,IAAqB,EAAE,MAAe;YAEnC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBACV,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC;oBACd,+BAAc,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;gBAC/E,CAAC,CAAC,CAAC;YACP,CAAC;QACL,CAAC,CAAC,CAAC;IACX,CAAC;IAiBD,sBAAW,uCAAI;QALf;;;;WAIG;aACH;YACI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;QACvC,CAAC;;;OAAA;IAML,4BAAC;AAAD,CAtDA,AAsDC,IAAA;AAtDqB,sDAAqB","file":"validatableController.js","sourcesContent":["import 'angular';\r\nimport {Promise} from 'es6-promise';\r\n\r\nimport { ErrorProcessor } from '../utils/errorProcessor';\r\nimport { IValidationRule } from '../interfaces/validationRule';\r\nimport { IRulesCustomizer } from '../interfaces/rulesCustomizer';\r\nimport { ValidationCore } from '../core/validationCore';\r\n\r\n/**\r\n * base controller class for validation purposes.\r\n */\r\nexport abstract class ValidatableController {\r\n\r\n    /**\r\n     * inits controller.\r\n     * \r\n     * @param scope\r\n     * @param validator\r\n     * @param entity\r\n     */\r\n    constructor(protected scope: ng.IScope, public rulesCustomizer: IRulesCustomizer) {\r\n    }\r\n\r\n    /**\r\n     * validation call.\r\n     */\r\n    protected validate(entity: Object): Promise<boolean> {\r\n\r\n        ErrorProcessor.clearAllFormErrors(this.form);\r\n\r\n        return ValidationCore.validateEntity(entity,\r\n            this.rulesCustomizer,\r\n            (rule: IValidationRule, result: boolean) => {\r\n\r\n                if (!result) {\r\n                    this.scope.$apply(() => {\r\n                        ErrorProcessor.setFieldError(rule.propertyName, rule.attribute, this.form);\r\n                    });\r\n                }\r\n            });\r\n    }\r\n\r\n    /**\r\n     * adds the server error to form validation.\r\n     */\r\n    protected addServerError = (fieldName: string, errorMesage: string) => {\r\n\r\n        this.scope.$apply(() => {\r\n            ErrorProcessor.addServerFieldError(fieldName, errorMesage, this.form);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * gets the form scope\r\n     * \r\n     * @returns {ng.IFormController}\r\n     */\r\n    public get form(): ng.IFormController {\r\n        return this.scope[this.formName()];\r\n    }\r\n\r\n    /**\r\n     * validation form name.\r\n     */\r\n    public abstract formName(): string;\r\n}"]}