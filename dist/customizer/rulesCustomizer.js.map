{"version":3,"sources":["customizer/rulesCustomizer.ts"],"names":[],"mappings":"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","file":"rulesCustomizer.js","sourcesContent":["import {Promise} from 'es6-promise';\nimport { IValidationRule } from '../interfaces/validationRule';\nimport { RequiredValidationRule } from '../validationRules/requiredValidationRule';\nimport { RealTimeServerValidationRule } from '../validationRules/serverValidationRule';\nimport { MinLenValidationRule } from '../validationRules/minLenValidationRule';\nimport { MaxLenValidationRule } from '../validationRules/maxLenValidationRule';\nimport { IRulesCustomizer } from '../interfaces/rulesCustomizer';\nimport { ValidationUtilities } from '../utils/validationUtilities';\n\n/**\n * helps to define validation rules for models.\n */\nexport class RulesCustomizer<T extends Object> implements IRulesCustomizer {\n\n    /**\n     * inits rules customizer.\n     * \n     * @param rulesMap\n     */\n    constructor(\n        private rulesMap: Map<string, IValidationRule[]> = new Map<string, IValidationRule[]>(),\n        private ruleSequense: Array<Array<IValidationRule>> = new Array<Array<IValidationRule>>()) {\n    }\n\n    /**\n     * makes field required.\n     * \n     * @param keyFunc\n     * @param message\n     */\n    public required(func: (obj: T) => void, message: string): void {\n        let key: string = ValidationUtilities.fromExpression<T>(func);\n        let rule: IValidationRule = new RequiredValidationRule(key, message);\n        this.addRule(key, rule);\n    }\n\n    /**\n     * max length valudation rule\n     * \n     * @param keyFunc\n     * @param value\n     * @param message\n     */\n    public maxlen(func: (obj: T) => void, value: number, message: string): void {\n        let key: string = ValidationUtilities.fromExpression<T>(func);\n        let rule: IValidationRule = new MaxLenValidationRule(key, value, message);\n        this.addRule(key, rule);\n    }\n\n    /**\n     * min length validation rule\n     * \n     * @param keyFunc\n     * @param value\n     * @param message\n     */\n    public minlen(func: (obj: T) => void, value: number, message: string): void {\n        let key: string = ValidationUtilities.fromExpression<T>(func);\n        let rule: IValidationRule = new MinLenValidationRule(key, value, message);\n        this.addRule(key, rule);\n    }\n\n    /**\n     * sets real time validation of the field.\n     * \n     * @param keyFunc\n     * @param validationCall\n     * @param message\n     */\n    public serverValidation(func: (obj: T) => void, validationCall: (value: any) => Promise<boolean>, message: string): void {\n        let key: string = ValidationUtilities.fromExpression<T>(func);\n        let rule: IValidationRule = new RealTimeServerValidationRule(key, validationCall, message);\n        this.addRule(key, rule);\n    }\n\n    /**\n     * adds validation rule to the dictionary.\n     * \n     * @param key\n     * @param rule\n     */\n    protected addRule(key: string, rule: IValidationRule): void {\n\n        if (!this.rulesMap[key]) {\n            this.rulesMap[key] = [];\n        }\n\n        this.rulesMap[key].push(rule);\n\n        let seqlIndex: number = this.rulesMap[key].length - 1;\n\n        if (!this.ruleSequense[seqlIndex]) {\n            this.ruleSequense[seqlIndex] = [];\n        }\n\n        this.ruleSequense[seqlIndex].push(rule);\n    }\n\n    /**\n     * gets the sequence rules for property.\n     */\n    public seqRules(key: string): Array<Array<IValidationRule>> {\n\n        let seqRules: Array<Array<IValidationRule>> = new Array<Array<IValidationRule>>();\n\n        let rules: IValidationRule[] = this.rulesMap[key];\n        if (rules && rules.length) {\n            for (let i: number = 0; i < this.rules.length; i++) {\n                seqRules[i] = [];\n                seqRules[i].push(rules[i]);\n            }\n        }\n\n        return seqRules;\n    }\n\n    /**\n     * gets all validation rules.\n     * \n     * @returns {Map<string, IValidationRule[]>}\n     */\n    public get rulesDictionary(): Map<string, IValidationRule[]> {\n        return this.rulesMap;\n    }\n\n    /**\n     * get rules sequence.\n     * \n     * @returns {Array<Array<IValidationRule>>}\n     */\n    public get rules(): Array<Array<IValidationRule>> {\n        return this.ruleSequense;\n    }\n}"]}